# Step 1.3: åŒºå—æ•°æ®ç»“æž„å®šä¹‰

## ðŸ“‹ æ¦‚è¿°

**ç›®æ ‡**: å®žçŽ°æ¯”ç‰¹å¸åŒºå—çš„å®Œæ•´æ•°æ®ç»“æž„ï¼ŒåŒ…æ‹¬åŒºå—å¤´ã€åŒºå—ä½“ã€åºåˆ—åŒ–æœºåˆ¶å’ŒåŸºç¡€éªŒè¯åŠŸèƒ½ã€‚

**å‰ç½®æ¡ä»¶**: Step 1.2 (å¯†ç å­¦å·¥å…·) å®Œæˆ  
**é¢„è®¡æ—¶é—´**: 2-3å¤©  
**éš¾åº¦çº§åˆ«**: â­â­â­

## ðŸŽ¯ åŠŸèƒ½è¦æ±‚

### æ ¸å¿ƒåŠŸèƒ½
- **åŒºå—å¤´ç»“æž„**: å®žçŽ°æ ‡å‡†æ¯”ç‰¹å¸åŒºå—å¤´æ ¼å¼
- **åŒºå—ç»“æž„**: å®Œæ•´çš„åŒºå—æ•°æ®ç»“æž„å®šä¹‰
- **åºåˆ—åŒ–æœºåˆ¶**: äºŒè¿›åˆ¶åºåˆ—åŒ–å’Œååºåˆ—åŒ–
- **å“ˆå¸Œè®¡ç®—**: åŒºå—å“ˆå¸Œå’ŒéªŒè¯æœºåˆ¶
- **åˆ›ä¸–åŒºå—**: ç½‘ç»œåˆå§‹åŒ–åŒºå—ç”Ÿæˆ
- **å¤§å°é™åˆ¶**: åŒºå—å¤§å°éªŒè¯å’Œé™åˆ¶

### æŠ€æœ¯è§„æ ¼
- **åŒºå—å¤´å¤§å°**: å›ºå®š80å­—èŠ‚
- **æœ€å¤§åŒºå—å¤§å°**: 1MB (1,000,000å­—èŠ‚)
- **å“ˆå¸Œç®—æ³•**: åŒé‡SHA-256
- **å­—èŠ‚åº**: å°ç«¯åº (Little Endian)
- **æ—¶é—´æˆ³ç²¾åº¦**: Unixæ—¶é—´æˆ³ (ç§’)

## ðŸ—ï¸ æž¶æž„è®¾è®¡

### æ•°æ®ç»“æž„å±‚æ¬¡
```
Block
â”œâ”€â”€ Header (BlockHeader)
â”‚   â”œâ”€â”€ Version (4å­—èŠ‚)
â”‚   â”œâ”€â”€ PrevBlockHash (32å­—èŠ‚)
â”‚   â”œâ”€â”€ MerkleRoot (32å­—èŠ‚)
â”‚   â”œâ”€â”€ Timestamp (4å­—èŠ‚)
â”‚   â”œâ”€â”€ Bits (4å­—èŠ‚)
â”‚   â””â”€â”€ Nonce (4å­—èŠ‚)
â””â”€â”€ Transactions ([]Transaction)
    â””â”€â”€ TransactionCount (VarInt)
```

### åŒºå—å¤´å­—æ®µè¯¦è§£

| å­—æ®µ | å¤§å° | ç±»åž‹ | æè¿° |
|------|------|------|------|
| Version | 4å­—èŠ‚ | uint32 | åŒºå—ç‰ˆæœ¬å·ï¼Œç”¨äºŽè½¯åˆ†å‰å‡çº§ |
| PrevBlockHash | 32å­—èŠ‚ | [32]byte | å‰ä¸€ä¸ªåŒºå—çš„å“ˆå¸Œå€¼ |
| MerkleRoot | 32å­—èŠ‚ | [32]byte | äº¤æ˜“Merkleæ ‘æ ¹å“ˆå¸Œ |
| Timestamp | 4å­—èŠ‚ | uint32 | åŒºå—åˆ›å»ºæ—¶é—´æˆ³ |
| Bits | 4å­—èŠ‚ | uint32 | éš¾åº¦ç›®æ ‡çš„ç´§å‡‘è¡¨ç¤º |
| Nonce | 4å­—èŠ‚ | uint32 | å·¥ä½œé‡è¯æ˜Žéšæœºæ•° |

## ðŸ“ æ–‡ä»¶ç»“æž„

```
pkg/blockchain/
â”œâ”€â”€ block.go          # åŒºå—ç»“æž„å®šä¹‰å’Œæ–¹æ³•
â”œâ”€â”€ genesis.go        # åˆ›ä¸–åŒºå—åˆ›å»º
â””â”€â”€ constants.go      # åŒºå—é“¾å¸¸é‡å®šä¹‰

test/blockchain/
â”œâ”€â”€ block_test.go     # åŒºå—ç»“æž„æµ‹è¯•
â””â”€â”€ genesis_test.go   # åˆ›ä¸–åŒºå—æµ‹è¯•
```

## ðŸ”§ å®žçŽ°å†…å®¹

### 1. åŒºå—å¤´ç»“æž„ (BlockHeader)

**å­—æ®µå®šä¹‰**:
```go
type BlockHeader struct {
    Version       uint32    // åŒºå—ç‰ˆæœ¬
    PrevBlockHash [32]byte  // å‰å—å“ˆå¸Œ
    MerkleRoot    [32]byte  // Merkleæ ¹
    Timestamp     uint32    // æ—¶é—´æˆ³
    Bits          uint32    // éš¾åº¦ç›®æ ‡
    Nonce         uint32    // éšæœºæ•°
}
```

**æ ¸å¿ƒæ–¹æ³•**:
- `Hash() [32]byte` - è®¡ç®—åŒºå—å¤´å“ˆå¸Œ
- `Serialize() []byte` - åºåˆ—åŒ–ä¸ºå­—èŠ‚æ•°ç»„
- `Deserialize([]byte) error` - ä»Žå­—èŠ‚æ•°ç»„ååºåˆ—åŒ–
- `IsValid() bool` - åŸºç¡€æœ‰æ•ˆæ€§éªŒè¯

### 2. åŒºå—ç»“æž„ (Block)

**å­—æ®µå®šä¹‰**:
```go
type Block struct {
    Header       *BlockHeader     // åŒºå—å¤´
    Transactions []*Transaction   // äº¤æ˜“åˆ—è¡¨
}
```

**æ ¸å¿ƒæ–¹æ³•**:
- `Hash() [32]byte` - èŽ·å–åŒºå—å“ˆå¸Œ
- `Size() int` - è®¡ç®—åŒºå—å¤§å°
- `Serialize() []byte` - å®Œæ•´åºåˆ—åŒ–
- `Deserialize([]byte) error` - å®Œæ•´ååºåˆ—åŒ–
- `Validate() error` - åŒºå—éªŒè¯
- `GetMerkleRoot() [32]byte` - è®¡ç®—Merkleæ ¹

### 3. åˆ›ä¸–åŒºå— (Genesis Block)

**ç‰¹æ®Šå±žæ€§**:
- PrevBlockHash: å…¨é›¶å“ˆå¸Œ
- å›ºå®šæ—¶é—´æˆ³: æ¯”ç‰¹å¸åˆ›ä¸–åŒºå—æ—¶é—´
- ç‰¹æ®Šäº¤æ˜“: Coinbaseäº¤æ˜“
- å›ºå®šéš¾åº¦: æœ€å¤§éš¾åº¦ç›®æ ‡

**åˆ›å»ºå‡½æ•°**:
```go
func CreateGenesisBlock() *Block
func GetGenesisBlockHash() [32]byte
func IsGenesisBlock(block *Block) bool
```

## ðŸ§ª æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•è¦†ç›–

**åŒºå—å¤´æµ‹è¯•**:
- âœ… åºåˆ—åŒ–å’Œååºåˆ—åŒ–ä¸€è‡´æ€§
- âœ… å“ˆå¸Œè®¡ç®—æ­£ç¡®æ€§
- âœ… å­—æ®µéªŒè¯å’Œè¾¹ç•Œæ¡ä»¶
- âœ… æ— æ•ˆæ•°æ®å¤„ç†

**åŒºå—æµ‹è¯•**:
- âœ… å®Œæ•´åŒºå—åºåˆ—åŒ–
- âœ… å¤§å°è®¡ç®—å‡†ç¡®æ€§
- âœ… Merkleæ ¹è®¡ç®—éªŒè¯
- âœ… åŒºå—å¤§å°é™åˆ¶éªŒè¯

**åˆ›ä¸–åŒºå—æµ‹è¯•**:
- âœ… åˆ›ä¸–åŒºå—ç”Ÿæˆ
- âœ… å“ˆå¸Œå€¼å›ºå®šæ€§
- âœ… ç‰¹æ®Šå±žæ€§éªŒè¯

### æ€§èƒ½æµ‹è¯•

**åŸºå‡†æµ‹è¯•**:
- åŒºå—åºåˆ—åŒ–æ€§èƒ½
- å“ˆå¸Œè®¡ç®—æ€§èƒ½
- å¤§åŒºå—å¤„ç†æ€§èƒ½
- å†…å­˜ä½¿ç”¨ä¼˜åŒ–

## ðŸ“Š éªŒè¯æ ‡å‡†

### åŠŸèƒ½éªŒè¯
1. **åºåˆ—åŒ–ä¸€è‡´æ€§**: åºåˆ—åŒ–åŽååºåˆ—åŒ–æ•°æ®å®Œå…¨ä¸€è‡´
2. **å“ˆå¸Œæ­£ç¡®æ€§**: åŒºå—å“ˆå¸Œè®¡ç®—ç¬¦åˆæ¯”ç‰¹å¸æ ‡å‡†
3. **å¤§å°é™åˆ¶**: æ­£ç¡®æ‰§è¡Œ1MBåŒºå—å¤§å°é™åˆ¶
4. **åˆ›ä¸–åŒºå—**: ç”Ÿæˆå›ºå®šä¸”å¯é‡çŽ°çš„åˆ›ä¸–åŒºå—

### æ€§èƒ½æŒ‡æ ‡
- **åºåˆ—åŒ–é€Ÿåº¦**: >1000 blocks/sec
- **å“ˆå¸Œè®¡ç®—**: <1ms per block
- **å†…å­˜ä½¿ç”¨**: <10MB for 1000 blocks
- **å¹¶å‘å®‰å…¨**: æ”¯æŒå¤šgoroutineè®¿é—®

## ðŸ”— ä¾èµ–å…³ç³»

### è¾“å…¥ä¾èµ–
- `pkg/utils/hash.go` - DoubleSHA256, MerkleRoot
- `pkg/utils/encoding.go` - å­—èŠ‚åºè½¬æ¢, VarInt
- `pkg/utils/crypto.go` - éšæœºæ•°ç”Ÿæˆ
- `time` - æ—¶é—´æˆ³å¤„ç†

### è¾“å‡ºæŽ¥å£
- ä¸ºStep 1.4 (Merkleæ ‘) æä¾›åŒºå—ç»“æž„
- ä¸ºStep 1.5 (åŒºå—é“¾) æä¾›åŒºå—å®šä¹‰
- ä¸ºæŒ–çŸ¿æ¨¡å—æä¾›åŒºå—æ¨¡æ¿

## ðŸ“ ä½¿ç”¨ç¤ºä¾‹

### åˆ›å»ºæ–°åŒºå—
```go
// åˆ›å»ºåŒºå—å¤´
header := &BlockHeader{
    Version:       1,
    PrevBlockHash: prevHash,
    MerkleRoot:    merkleRoot,
    Timestamp:     uint32(time.Now().Unix()),
    Bits:          difficulty,
    Nonce:         0,
}

// åˆ›å»ºåŒºå—
block := &Block{
    Header:       header,
    Transactions: transactions,
}

// è®¡ç®—åŒºå—å“ˆå¸Œ
blockHash := block.Hash()
```

### åºåˆ—åŒ–å’Œååºåˆ—åŒ–
```go
// åºåˆ—åŒ–åŒºå—
data := block.Serialize()

// ååºåˆ—åŒ–åŒºå—
newBlock := &Block{}
err := newBlock.Deserialize(data)
if err != nil {
    log.Fatal("ååºåˆ—åŒ–å¤±è´¥:", err)
}
```

### åˆ›ä¸–åŒºå—ä½¿ç”¨
```go
// èŽ·å–åˆ›ä¸–åŒºå—
genesis := CreateGenesisBlock()

// éªŒè¯æ˜¯å¦ä¸ºåˆ›ä¸–åŒºå—
if IsGenesisBlock(genesis) {
    fmt.Println("åˆ›ä¸–åŒºå—éªŒè¯æˆåŠŸ")
}
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### å®‰å…¨è€ƒè™‘
- **å“ˆå¸ŒéªŒè¯**: æ‰€æœ‰åŒºå—å“ˆå¸Œå¿…é¡»éªŒè¯
- **å¤§å°é™åˆ¶**: ä¸¥æ ¼æ‰§è¡ŒåŒºå—å¤§å°é™åˆ¶
- **æ—¶é—´æˆ³éªŒè¯**: é˜²æ­¢æ—¶é—´æˆ³æ”»å‡»
- **è¾“å…¥éªŒè¯**: æ‰€æœ‰å¤–éƒ¨è¾“å…¥å¿…é¡»éªŒè¯

### æ€§èƒ½ä¼˜åŒ–
- **å†…å­˜æ± åŒ–**: é‡ç”¨åºåˆ—åŒ–ç¼“å†²åŒº
- **å¹¶å‘å®‰å…¨**: ä½¿ç”¨åªè¯»æ“ä½œé¿å…é”
- **ç¼“å­˜æœºåˆ¶**: ç¼“å­˜è®¡ç®—ç»“æžœ
- **æ‰¹é‡å¤„ç†**: æ”¯æŒæ‰¹é‡åºåˆ—åŒ–

### å…¼å®¹æ€§
- **å­—èŠ‚åº**: ä¸¥æ ¼éµå¾ªå°ç«¯åº
- **ç‰ˆæœ¬æŽ§åˆ¶**: æ”¯æŒæœªæ¥ç‰ˆæœ¬å‡çº§
- **å‘åŽå…¼å®¹**: ä¿æŒAPIç¨³å®šæ€§

## ðŸš€ ä¸‹ä¸€æ­¥

å®ŒæˆStep 1.3åŽï¼Œå°†å…·å¤‡ï¼š
- âœ… å®Œæ•´çš„åŒºå—æ•°æ®ç»“æž„
- âœ… å¯é çš„åºåˆ—åŒ–æœºåˆ¶
- âœ… æ ‡å‡†çš„å“ˆå¸Œè®¡ç®—
- âœ… åˆ›ä¸–åŒºå—æ”¯æŒ

**å‡†å¤‡è¿›å…¥Step 1.4**: Merkleæ ‘å®žçŽ°ï¼Œåˆ©ç”¨å·²å®šä¹‰çš„åŒºå—ç»“æž„æž„å»ºäº¤æ˜“éªŒè¯æœºåˆ¶ã€‚
